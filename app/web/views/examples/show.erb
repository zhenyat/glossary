<%#
################################################################################
#   File:     app/web/views/examples/show.erb
#   Purpose:  Show example details (snippet + phrases) with actions
#   Author:   ChatGPT (GPT-4.1)
#   Date:     2025-10-28
#   Updated:  2025-10-30  Includes CSRF token on mutating forms
################################################################################
%>

<div class="d-flex justify-content-between align-items-center mb-2">
  <h3>
    Example for
    <% if defined?(@command) && @command %>
      <code><%= h(@command.title) %></code>
    <% else %>
      <em>(unknown command)</em>
    <% end %>
    <% if @example&.deleted_on %>
      <span class="badge text-bg-warning ms-2">deleted</span>
    <% end %>
  </h3>

  <div class="d-flex gap-2">
    <%# Delete / Restore %>
    <% if @example&.deleted_on.nil? %>
      <form class="d-inline" method="post" action="/examples/<%= @example.id %>/delete?<%= request.query_string %>">
        <button class="btn btn-sm btn-outline-danger"
                onclick="return confirm('Soft-delete this example?')">Delete</button>
      </form>
    <% else %>
      <form class="d-inline" method="post" action="/examples/<%= @example.id %>/restore?<%= request.query_string %>">
        <button class="btn btn-sm btn-outline-success">Restore</button>
      </form>
    <% end %>

    <a class="btn btn-sm btn-outline-secondary"
       href="/examples/<%= @example.id %>/edit?<%= request.query_string %>">Edit</a>

    <% if defined?(@command) && @command %>
      <a class="btn btn-sm btn-outline-primary"
         href="/commands/<%= @command.id %>?<%= request.query_string %>">Back to command</a>
    <% else %>
      <a class="btn btn-sm btn-outline-primary" href="/commands">Back</a>
    <% end %>
  </div>
</div>

<div class="mb-3">
  <div class="mb-1 text-muted">
    <% if defined?(@command) && @command && @command.category %>
      <strong>Category:</strong> <%= h(@command.category.name_en) %>
      <span class="text-body-secondary">|</span>
    <% end %>
    <strong>Example ID:</strong> <%= @example.id %>
  </div>
  <h6 class="mb-2">Snippet (title)</h6>
  <code><%= h(@example.title) %></code>
</div>

<div class="row">
  <div class="col-md-6 mb-3">
    <h6>Phrase (EN)</h6>
    <pre class="mb-0"><%= h(@example.descr_en) %></pre>
  </div>
  <div class="col-md-6 mb-3">
    <h6>Phrase (RU)</h6>
    <pre class="mb-0"><%= h(@example.descr_ru) %></pre>
  </div>
</div>

<p class="text-muted small mt-3">
  <strong>Created:</strong> <%= h(@example.created_at) %>
  <span class="text-body-secondary">|</span>
  <strong>Updated:</strong> <%= h(@example.updated_at) %>
  <% if @example.deleted_on %>
    <span class="text-body-secondary">|</span>
    <strong>Deleted:</strong> <%= h(@example.deleted_on) %>
  <% end %>
</p>